<!--
Este archivo HTML define el formulario para crear y editar mascotas.
Es una vista reutilizable que adapta su t칤tulo, acci칩n del formulario y valores de los campos
dependiendo de si se est치 creando una nueva mascota (el objeto 'mascota' es nulo) o editando
una existente (el objeto 'mascota' est치 presente).
Utiliza Thymeleaf para esta l칩gica condicional y para poblar los campos del formulario.
-->
<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- El t칤tulo de la p치gina cambia din치micamente -->
    <title th:text="${mascota != null} ? 'Editar Mascota' : 'A침adir Mascota'">A침adir Mascota - Petcare</title>
    <link rel="icon" type="image/svg+xml" th:href="@{/favicon.svg}">
    <link rel="stylesheet" th:href="@{/css/styles.css}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>

<body class="mascota-form-page">
    <!-- Inclusi칩n del fragmento de la barra de navegaci칩n -->
    <div th:replace="fragments/header :: navbar"></div>

    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-8 col-lg-6">
                <div class="form-container card">
                    <div class="card-body p-5">
                        <div class="text-center mb-4">
                            <!-- El 칤cono y los textos del encabezado cambian seg칰n si es modo edici칩n o creaci칩n -->
                            <i class="pet-icon fas"
                                th:classappend="${mascota != null} ? 'fa-edit' : 'fa-plus-circle'"></i>
                            <h2 class="fw-bold text-primary"
                                th:text="${mascota != null} ? 'Editar Mascota' : 'A침adir Nueva Mascota'">A침adir Nueva
                                Mascota</h2>
                            <p class="text-muted"
                                th:text="${mascota != null} ? 'Modifica los datos de la mascota' : 'Registra una nueva mascota en el sistema'">
                                Registra una nueva mascota en el sistema</p>
                        </div>

                        <!--
                        El formulario env칤a los datos al endpoint correspondiente.
                        - Si 'mascota' no es nulo, la acci칩n es '/mascotas/{id}/editar'.
                        - Si 'mascota' es nulo, la acci칩n es '/mascotas'.
                        -->
                        <form
                            th:action="${mascota != null} ? @{'/mascotas/' + ${mascota.id} + '/editar'} : @{/mascotas}"
                            method="post">
                            <div class="row g-3">
                                <!-- Campo para el nombre de la mascota. 'th:value' llena el campo si se est치 editando. -->
                                <div class="col-12">
                                    <div class="form-floating">
                                        <input type="text" class="form-control" id="nombre" name="nombre"
                                            placeholder="Nombre de la mascota" required
                                            th:value="${mascota != null} ? ${mascota.nombre} : ''">
                                        <label for="nombre">
                                            <i class="fas fa-tag me-2"></i>Nombre
                                        </label>
                                    </div>
                                </div>

                                <!-- Campo de selecci칩n para la especie. 'th:selected' marca la opci칩n correcta en modo edici칩n. -->
                                <div class="col-12">
                                    <div class="form-floating">
                                        <select class="form-select" id="especie" name="especie" required>
                                            <option value="">Seleccionar especie</option>
                                            <option value="PERRO"
                                                th:selected="${mascota != null and mascota.especie=='PERRO'}">游냇 Perro
                                            </option>
                                            <option value="GATO"
                                                th:selected="${mascota != null and mascota.especie=='GATO'}">游냠 Gato
                                            </option>
                                            <option value="AVE"
                                                th:selected="${mascota != null and mascota.especie=='AVE'}">游냕 Ave
                                            </option>
                                            <option value="REPTIL"
                                                th:selected="${mascota != null and mascota.especie=='REPTIL'}">游붍 Reptil
                                            </option>
                                            <option value="PEZ"
                                                th:selected="${mascota != null and mascota.especie=='PEZ'}">游 Pez
                                            </option>
                                            <option value="OTRO"
                                                th:selected="${mascota != null and mascota.especie=='OTRO'}">游 Otro
                                            </option>
                                        </select>
                                        <label for="especie">
                                            <i class="fas fa-paw me-2"></i>Especie
                                        </label>
                                    </div>
                                </div>

                                <!-- Campo para la raza -->
                                <div class="col-12">
                                    <div class="form-floating">
                                        <input type="text" class="form-control" id="raza" name="raza"
                                            placeholder="Raza de la mascota"
                                            th:value="${mascota != null} ? ${mascota.raza} : ''">
                                        <label for="raza">
                                            <i class="fas fa-dna me-2"></i>Raza (opcional)
                                        </label>
                                    </div>
                                </div>

                                <!-- Campos para fecha de nacimiento y peso -->
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <input type="date" class="form-control" id="fechaNacimiento"
                                            name="fechaNacimiento"
                                            th:value="${mascota != null and mascota.fechaNacimiento != null} ? ${mascota.fechaNacimiento} : ''">
                                        <label for="fechaNacimiento">
                                            <i class="fas fa-calendar-alt me-2"></i>Fecha de Nacimiento
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <input type="number" step="0.1" class="form-control" id="peso" name="peso"
                                            placeholder="Peso en kg"
                                            th:value="${mascota != null and mascota.peso != null} ? ${mascota.peso} : ''">
                                        <label for="peso">
                                            <i class="fas fa-weight me-2"></i>Peso (kg)
                                        </label>
                                    </div>
                                </div>

                                <!--
                                Campo para seleccionar el due침o.
                                'th:if="${duenos}"' muestra este campo solo si la lista de due침os est치 disponible (t칤picamente para un admin).
                                -->
                                <div class="col-12" th:if="${duenos}">
                                    <div class="form-floating">
                                        <select class="form-select" id="duenoId" name="duenoId" required>
                                            <option value="">Seleccionar due침o</option>
                                            <option th:each="dueno : ${duenos}" th:value="${dueno.id}"
                                                th:text="${dueno.nombre}"
                                                th:selected="${mascota != null and mascota.dueno != null and dueno.id == mascota.dueno.id}">
                                            </option>
                                        </select>
                                        <label for="duenoId">
                                            <i class="fas fa-user me-2"></i>Due침o
                                        </label>
                                    </div>
                                </div>
                                <!-- Si no hay lista de due침os, se asume que el usuario actual es el due침o. -->
                                <input type="hidden" name="duenoId" th:if="${duenos == null}"
                                    th:value="${usuario != null} ? ${usuario.dueno.id} : ''" />

                                <!-- Botones para guardar o volver -->
                                <div class="col-12 mt-4">
                                    <button type="submit" class="btn btn-primary w-100 mb-2">
                                        <i class="fas fa-save me-2"></i>Guardar Mascota
                                    </button>
                                    <a href="/admin" class="btn btn-outline-secondary w-100">
                                        <i class="fas fa-arrow-left me-2"></i>Volver
                                    </a>
                                </div>
                            </div>
                        </form>

                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Inclusi칩n del fragmento del footer -->
    <div th:replace="fragments/footer :: footer"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>